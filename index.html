<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione Promemoria</title>
    <style>
        :root {
            --primary-color: #007BFF;
            --background-color: #f4f4f4;
            --text-color: #333;
            --border-color: #ddd;
        }
        
        .dark-mode {
            --primary-color: #333;
            --background-color: #222;
            --text-color: #f4f4f4;
            --border-color: #555;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
        }
        
        #sidebar {
            width: 250px;
            background-color: var(--primary-color);
            color: #fff;
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            padding: 20px;
            transition: margin-left 0.3s;
        }
        
        #sidebar h1 {
            font-size: 24px;
            margin: 0;
        }
        
        #sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        #sidebar ul li {
            margin: 15px 0;
        }
        
        #sidebar ul li a {
            color: #fff;
            text-decoration: none;
            font-size: 18px;
        }
        
        #sidebar ul li a:hover {
            text-decoration: underline;
        }
        
        #sidebar-toggle {
            position: absolute;
            top: 20px;
            right: -40px;
            background-color: var(--primary-color);
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: right 0.3s;
        }
        
        #container {
            margin-left: 250px;
            padding: 20px;
            width: calc(100% - 270px);
            transition: margin-left 0.3s;
        }
        
        .container {
            background-color: var(--background-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0 10px 0;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }
        
        button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background-color: #0056b3;
        }
        
        .reminder-item {
            background: var(--background-color);
            border: 1px solid var(--border-color);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .reminder-item.completed {
            text-decoration: line-through;
            background: #e0ffe0;
        }
        
        .reminder-item button {
            background: #dc3545;
        }
        
        .reminder-item button:hover {
            background: #c82333;
        }
        
        .search-bar {
            margin-bottom: 15px;
        }
        
        .theme-picker, .color-picker {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        
        .theme-option, .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
        }
        
        .theme-option {
            border: 2px solid var(--border-color);
        }
        
        .color-option {
            border: 2px solid var(--border-color);
        }
        
        .theme-option.selected, .color-option.selected {
            border: 2px solid #000;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <div id="sidebar-toggle" onclick="toggleSidebar()">‚ò∞</div>
        <h1>Menu</h1>
        <ul>
            <li><a href="#" onclick="showSection('add-reminder-container')">Aggiungi Promemoria</a></li>
            <li><a href="#" onclick="showSection('view-reminders-container')">Visualizza Promemoria</a></li>
            <li><a href="#" onclick="showSection('settings-container')">Impostazioni</a></li>
        </ul>
    </div>
    <div id="container">
        <div id="add-reminder-container" class="container active">
            <h2>Aggiungi un Nuovo Promemoria</h2>
            <div class="input-group">
                <label for="reminder-text">Promemoria:</label>
                <input type="text" id="reminder-text" placeholder="Inserisci il tuo promemoria">
            </div>
            <div class="input-group">
                <label for="reminder-date">Data e Ora:</label>
                <input type="datetime-local" id="reminder-date">
            </div>
            <div class="input-group">
                <label for="reminder-icon">Icona:</label>
                <select id="reminder-icon">
                    <option value="üìù">üìù Nota</option>
                    <option value="üéâ">üéâ Celebrazione</option>
                    <option value="üèãÔ∏è">üèãÔ∏è Esercizio</option>
                    <option value="üçΩÔ∏è">üçΩÔ∏è Pasto</option>
                    <option value="üíº">üíº Lavoro</option>
                    <option value="üéÅ">üéÅ Regalo</option>
                </select>
            </div>
            <button onclick="addReminder()">Aggiungi Promemoria</button>
        </div>

        <div id="view-reminders-container" class="container">
            <h2>Visualizza Promemoria</h2>
            <div class="search-bar">
                <input type="text" id="search-reminder" placeholder="Cerca promemoria" onkeyup="filterReminders()">
            </div>
            <div id="reminders-list"></div>
        </div>

        <div id="settings-container" class="container">
            <h2>Impostazioni</h2>
            <div class="theme-picker">
                <div class="theme-option" style="background-color: #FFB3B3;" onclick="setTheme('#FFB3B3', '#F9EAE9', '#333')"></div>
                <div class="theme-option" style="background-color: #B3E0FF;" onclick="setTheme('#B3E0FF', '#E6F0FF', '#333')"></div>
                <div class="theme-option" style="background-color: #B3FFB3;" onclick="setTheme('#B3FFB3', '#E6F9E6', '#333')"></div>
                <div class="theme-option" style="background-color: #FFD9B3;" onclick="setTheme('#FFD9B3', '#FDF0E6', '#333')"></div>
            </div>
            <div class="color-picker">
                <div class="color-option" style="background-color: #FFB3B3;" onclick="setColor('#FFB3B3')"></div>
                <div class="color-option" style="background-color: #B3E0FF;" onclick="setColor('#B3E0FF')"></div>
                <div class="color-option" style="background-color: #B3FFB3;" onclick="setColor('#B3FFB3')"></div>
                <div class="color-option" style="background-color: #FFD9B3;" onclick="setColor('#FFD9B3')"></div>
            </div>
            <div class="input-group">
                <label for="theme-toggle">Tema scuro:</label>
                <input type="checkbox" id="theme-toggle" onclick="toggleDarkMode()">
            </div>
        </div>
    </div>

    <script>
        let selectedColor = '#FFFFFF';
        let selectedTheme = { primary: '#007BFF', background: '#f4f4f4', text: '#333' };

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const container = document.getElementById('container');
            if (sidebar.style.marginLeft === '0px') {
                sidebar.style.marginLeft = '-250px';
                container.style.marginLeft = '0';
            } else {
                sidebar.style.marginLeft = '0';
                container.style.marginLeft = '250px';
            }
        }

        function showSection(sectionId) {
            const sections = document.querySelectorAll('#container > div');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }

        function setTheme(primaryColor, backgroundColor, textColor) {
            document.documentElement.style.setProperty('--primary-color', primaryColor);
            document.documentElement.style.setProperty('--background-color', backgroundColor);
            document.documentElement.style.setProperty('--text-color', textColor);
        }

        function setColor(color) {
            selectedColor = color;
            document.body.style.backgroundColor = color;
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
        }

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js').then(reg => {
                console.log('Service Worker registrato con successo:', reg);
                return reg.pushManager.getSubscription();
            }).then(subscription => {
                if (subscription === null) {
                    console.log('Non sei iscritto alle notifiche.');
                } else {
                    console.log('Sei gi√† iscritto alle notifiche:', subscription);
                }
            }).catch(error => {
                console.error('Registrazione del Service Worker fallita:', error);
            });
        }

        const reminders = JSON.parse(localStorage.getItem('reminders')) || [];

        function renderReminders() {
            const remindersList = document.getElementById('reminders-list');
            remindersList.innerHTML = '';
            reminders.forEach(reminder => {
                const reminderItem = document.createElement('div');
                reminderItem.className = `reminder-item ${reminder.completed ? 'completed' : ''}`;
                reminderItem.innerHTML = `
                    <div class="text">${reminder.icon} ${reminder.text} <span>(${new Date(reminder.date).toLocaleString()})</span></div>
                    <button onclick="toggleComplete(${reminder.id})">Completa</button>
                    <button onclick="deleteReminder(${reminder.id})">Elimina</button>
                `;
                remindersList.appendChild(reminderItem);
            });
        }

        function addReminder() {
            const text = document.getElementById('reminder-text').value;
            const date = document.getElementById('reminder-date').value;
            const icon = document.getElementById('reminder-icon').value;

            if (!text || !date) {
                alert('Per favore, compila tutti i campi');
                return;
            }

            const reminder = {
                id: Date.now(),
                text,
                date: new Date(date).toISOString(),
                icon,
                completed: false
            };

            reminders.push(reminder);
            localStorage.setItem('reminders', JSON.stringify(reminders));
            renderReminders();

            const reminderDate = new Date(date);
            const now = new Date();
            const timeUntilReminder = reminderDate - now;

            if (timeUntilReminder > 0) {
                setTimeout(() => {
                    sendNotification(reminder);
                }, timeUntilReminder);
            }
        }

        function sendNotification(reminder) {
            if (Notification.permission === 'granted') {
                navigator.serviceWorker.getRegistration().then(reg => {
                    reg.showNotification(`${reminder.icon} Promemoria`, {
                        body: reminder.text,
                        icon: 'path_to_icon.png'
                    });
                });
            }
        }

        function toggleComplete(id) {
            const reminder = reminders.find(r => r.id === id);
            if (reminder) {
                reminder.completed = !reminder.completed;
                localStorage.setItem('reminders', JSON.stringify(reminders));
                renderReminders();
            }
        }

        function deleteReminder(id) {
            const index = reminders.findIndex(r => r.id === id);
            if (index !== -1) {
                reminders.splice(index, 1);
                localStorage.setItem('reminders', JSON.stringify(reminders));
                renderReminders();
            }
        }

        function filterReminders() {
            const searchText = document.getElementById('search-reminder').value.toLowerCase();
            const filteredReminders = reminders.filter(reminder =>
                reminder.text.toLowerCase().includes(searchText)
            );
            const remindersList = document.getElementById('reminders-list');
            remindersList.innerHTML = '';
            filteredReminders.forEach(reminder => {
                const reminderItem = document.createElement('div');
                reminderItem.className = `reminder-item ${reminder.completed ? 'completed' : ''}`;
                reminderItem.innerHTML = `
                    <div class="text">${reminder.icon} ${reminder.text} <span>(${new Date(reminder.date).toLocaleString()})</span></div>
                    <button onclick="toggleComplete(${reminder.id})">Completa</button>
                    <button onclick="deleteReminder(${reminder.id})">Elimina</button>
                `;
                remindersList.appendChild(reminderItem);
            });
        }

        if (Notification.permission !== 'granted') {
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    console.log('Permesso per le notifiche concesso');
                } else {
                    console.log('Permesso per le notifiche negato');
                }
            });
        }

        renderReminders();
    </script>
</body>
</html>
