<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione Promemoria</title>
    <style>
        /* Tailwind CSS CDN */
        @import url('https://cdn.jsdelivr.net/npm/tailwindcss@3.0.0/dist/tailwind.min.css');

        /* Modal and animation styles */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        #reminder-form {
            animation: fadeIn 0.3s ease-in-out;
        }

        #reminder-form.hidden {
            display: none;
            animation: fadeOut 0.3s ease-in-out;
        }

        /* Card effects */
        .reminder-item {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .reminder-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* Dark mode styles */
        body.dark-mode {
            background-color: #1a202c;
            color: #e2e8f0;
        }

        body.dark-mode .bg-white {
            background-color: #2d3748;
            border-color: #4a5568;
        }

        body.dark-mode .text-gray-900 {
            color: #edf2f7;
        }

        body.dark-mode .text-gray-100 {
            color: #e2e8f0;
        }
    </style>
</head>
<body>
    <div class="container mx-auto p-6">
        <header class="flex justify-between items-center mb-6">
            <h1 class="text-4xl font-bold text-gray-900 dark:text-gray-100">Gestione Promemoria</h1>
            <button id="theme-toggle" class="px-4 py-2 bg-blue-500 text-white rounded-lg focus:outline-none">Passa al Tema Scuro</button>
        </header>
        
        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg flex flex-col space-y-4">
                <button id="open-form" class="px-4 py-2 bg-green-500 text-white rounded-lg focus:outline-none w-full">Aggiungi Promemoria</button>
                <div id="reminder-chart" class="h-64 w-full"></div>
                <div id="calendar-view" class="h-64 w-full"></div>
            </div>
            
            <div class="col-span-1 md:col-span-2 lg:col-span-2 bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
                <input type="text" id="search-reminder" placeholder="Cerca promemoria" onkeyup="filterReminders()" class="w-full p-2 border border-gray-300 rounded-md mb-4">
                <div id="reminders-list"></div>
            </div>
        </section>

        <div id="reminder-form" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg w-full max-w-lg">
                <h2 class="text-2xl font-bold mb-4">Nuovo Promemoria</h2>
                <label for="reminder-text" class="block text-sm font-medium mb-2">Promemoria:</label>
                <input type="text" id="reminder-text" placeholder="Inserisci il tuo promemoria" class="w-full p-2 border border-gray-300 rounded-md mb-4">
                <label for="reminder-date" class="block text-sm font-medium mb-2">Data e Ora:</label>
                <input type="datetime-local" id="reminder-date" class="w-full p-2 border border-gray-300 rounded-md mb-4">
                <label for="reminder-icon" class="block text-sm font-medium mb-2">Icona:</label>
                <select id="reminder-icon" class="w-full p-2 border border-gray-300 rounded-md mb-4">
                    <option value="üìù">üìù Nota</option>
                    <option value="üéâ">üéâ Celebrazione</option>
                    <option value="üèãÔ∏è">üèãÔ∏è Esercizio</option>
                    <option value="üçΩÔ∏è">üçΩÔ∏è Pasto</option>
                    <option value="üíº">üíº Lavoro</option>
                    <option value="üéÅ">üéÅ Regalo</option>
                </select>
                <label for="reminder-category" class="block text-sm font-medium mb-2">Categoria:</label>
                <select id="reminder-category" class="w-full p-2 border border-gray-300 rounded-md mb-4">
                    <option value="lavoro">Lavoro</option>
                    <option value="personale">Personale</option>
                    <option value="salute">Salute</option>
                    <option value="finanze">Finanze</option>
                </select>
                <label for="reminder-priority" class="block text-sm font-medium mb-2">Priorit√†:</label>
                <select id="reminder-priority" class="w-full p-2 border border-gray-300 rounded-md mb-4">
                    <option value="bassa">Bassa</option>
                    <option value="media">Media</option>
                    <option value="alta">Alta</option>
                </select>
                <button onclick="addReminder()" class="px-4 py-2 bg-blue-500 text-white rounded-lg focus:outline-none">Aggiungi</button>
                <button onclick="closeForm()" class="px-4 py-2 bg-red-500 text-white rounded-lg focus:outline-none ml-2">Chiudi</button>
            </div>
        </div>
    </div>
    <script>
        // Handle theme toggle
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;

        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            themeToggle.textContent = body.classList.contains('dark-mode') ? 'Passa al Tema Chiaro' : 'Passa al Tema Scuro';
        });

        // Handle form visibility
        const openFormButton = document.getElementById('open-form');
        const formModal = document.getElementById('reminder-form');

        function openForm() {
            formModal.classList.remove('hidden');
        }

        function closeForm() {
            formModal.classList.add('hidden');
        }

        openFormButton.addEventListener('click', openForm);

        // Data storage and rendering
        let reminders = JSON.parse(localStorage.getItem('reminders')) || [];

        function renderReminders() {
            const remindersList = document.getElementById('reminders-list');
            remindersList.innerHTML = '';
            reminders.forEach(reminder => {
                const reminderItem = document.createElement('div');
                reminderItem.className = `reminder-item ${reminder.completed ? 'completed' : ''} p-4 mb-2 border border-gray-300 rounded-md bg-white dark:bg-gray-700 dark:border-gray-600 flex justify-between items-center`;
                reminderItem.innerHTML = `
                    <div class="text">${reminder.icon} ${reminder.text} <span class="text-gray-500">(${new Date(reminder.date).toLocaleString()})</span></div>
                    <div class="flex space-x-2">
                        <button onclick="toggleComplete(${reminder.id})" class="px-3 py-1 bg-green-500 text-white rounded-lg focus:outline-none">${reminder.completed ? 'Non Completato' : 'Completa'}</button>
                        <button onclick="deleteReminder(${reminder.id})" class="px-3 py-1 bg-red-500 text-white rounded-lg focus:outline-none">Elimina</button>
                    </div>
                `;
                remindersList.appendChild(reminderItem);
            });
        }

        function addReminder() {
            const text = document.getElementById('reminder-text').value;
            const date = document.getElementById('reminder-date').value;
            const icon = document.getElementById('reminder-icon').value;
            const category = document.getElementById('reminder-category').value;
            const priority = document.getElementById('reminder-priority').value;

            if (!text || !date) {
                alert('Per favore, compila tutti i campi');
                return;
            }

            const reminder = {
                id: Date.now(),
                text,
                date: new Date(date).toISOString(),
                icon,
                category,
                priority,
                completed: false
            };

            reminders.push(reminder);
            localStorage.setItem('reminders', JSON.stringify(reminders));
            renderReminders();

            scheduleNotification(reminder);

            closeForm();
        }

        function scheduleNotification(reminder) {
            const reminderDate = new Date(reminder.date);
            const now = new Date();
            const timeUntilReminder = reminderDate - now;

            if (timeUntilReminder > 0) {
                setTimeout(() => {
                    sendNotification(reminder);
                }, timeUntilReminder);
            }
        }

        function toggleComplete(id) {
            reminders = reminders.map(reminder => {
                if (reminder.id === id) {
                    return { ...reminder, completed: !reminder.completed };
                }
                return reminder;
            });
            localStorage.setItem('reminders', JSON.stringify(reminders));
            renderReminders();
        }

        function deleteReminder(id) {
            reminders = reminders.filter(reminder => reminder.id !== id);
            localStorage.setItem('reminders', JSON.stringify(reminders));
            renderReminders();
        }

        function filterReminders() {
            const searchTerm = document.getElementById('search-reminder').value.toLowerCase();
            const filteredReminders = reminders.filter(reminder => reminder.text.toLowerCase().includes(searchTerm));
            renderFilteredReminders(filteredReminders);
        }

        function renderFilteredReminders(filteredReminders) {
            const remindersList = document.getElementById('reminders-list');
            remindersList.innerHTML = '';
            filteredReminders.forEach(reminder => {
                const reminderItem = document.createElement('div');
                reminderItem.className = `reminder-item ${reminder.completed ? 'completed' : ''} p-4 mb-2 border border-gray-300 rounded-md bg-white dark:bg-gray-700 dark:border-gray-600 flex justify-between items-center`;
                reminderItem.innerHTML = `
                    <div class="text">${reminder.icon} ${reminder.text} <span class="text-gray-500">(${new Date(reminder.date).toLocaleString()})</span></div>
                    <div class="flex space-x-2">
                        <button onclick="toggleComplete(${reminder.id})" class="px-3 py-1 bg-green-500 text-white rounded-lg focus:outline-none">${reminder.completed ? 'Non Completato' : 'Completa'}</button>
                        <button onclick="deleteReminder(${reminder.id})" class="px-3 py-1 bg-red-500 text-white rounded-lg focus:outline-none">Elimina</button>
                    </div>
                `;
                remindersList.appendChild(reminderItem);
            });
        }

        function sendNotification(reminder) {
            if (Notification.permission === 'granted') {
                new Notification('Promemoria', {
                    body: `${reminder.icon} ${reminder.text}`,
                    icon: 'path_to_icon.png'
                });
            }
        }

        if (Notification.permission !== 'granted') {
            Notification.requestPermission();
        }

        renderReminders();
    </script>
</body>
</html>
